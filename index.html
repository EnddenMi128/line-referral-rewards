<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>æœƒå“¡ç™»è¨˜</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #f7f7f7;
    }
    .box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 16px;
    }
    button {
      background: #06C755;
      color: white;
      border: none;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<div class="box">
  <h2>å¡«è³‡æ–™é ˜10å…ƒå„ªæƒ åˆ¸</h2>

  <input id="name" placeholder="è«‹è¼¸å…¥å§“å">
  <input id="phone" placeholder="è«‹è¼¸å…¥é›»è©±">

  <button onclick="submitForm()">é€å‡ºä¸¦é ˜å„ªæƒ åˆ¸</button>

  <p id="msg"></p>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbxDl3w29rVR73EznImE4nZ9-q0FXHbGXVOt0dCvct1i97v540YrEC786dAd-upu0k1jzw/exec";

let userId = "";
let refUserId = "";

async function init() {
  await liff.init({ liffId: "2009103012-Cm3dsFrN" });

  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  const profile = await liff.getProfile();
  userId = profile.userId;

  // è®€æ¨è–¦ç¢¼
  const urlParams = new URLSearchParams(window.location.search);
  refUserId = urlParams.get("refUserId") || "";
}

init();

async function submitForm() {
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;

  if (!name || !phone) {
    alert("è«‹å¡«å¯«å§“åèˆ‡é›»è©±");
    return;
  }

  const formData = new URLSearchParams();
  formData.append("userId", userId);
  formData.append("name", name);
  formData.append("phone", phone);
  formData.append("refUserId", refUserId);

  const res = await fetch(GAS_URL, {
    method: "POST",
    body: formData
  });

  const text = await res.text();

  if (text.includes("ALREADY_MEMBER")) {
    document.getElementById("msg").innerText = "ä½ å·²ç¶“é ˜éå„ªæƒ åˆ¸å›‰ï¼";
  } else {
    document.getElementById("msg").innerText = "å®Œæˆï¼å„ªæƒ åˆ¸å·²é€åˆ°LINE ğŸ‰";
  }
}
</script>

</body>
</html>

